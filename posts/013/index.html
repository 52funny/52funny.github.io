<!doctype html><html lang=zh-hans><meta charset=utf-8><meta name=generator content="Hugo 0.119.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>KINGOSOFT模拟登陆&nbsp;&ndash;&nbsp;52funny Blog</title><link rel=stylesheet href=/css/core.min.f9b23fe57ee1e0c49df056e1568197ac8020cde0cf8113c1b532070854073b8f05cef8631555e6d24c3ad2c550a48deb.css integrity=sha384-+bI/5X7h4MSd8FbhVoGXrIAgzeDPgRPBtTIHCFQHO48FzvhjFVXm0kw60sVQpI3r><meta name=twitter:card content="summary"><meta name=twitter:title content="KINGOSOFT模拟登陆"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">52funny Blog</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/></a><a class="nav item" href=/tags/></a><a class="nav item" href=/>Home</a><a class="nav item" href=/algorithm>Algorithm</a><a class="nav item" href=/friends>Friends</a><a class="nav item" href=/about>About</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">KINGOSOFT模拟登陆</h1><p class="article date">2020-04-14</p></section><article class="article markdown-body"><p>最近在家实在无聊,然后打开了教务系统然后对他的登陆系统分析了一下发现大概是以下步骤</p><p><img src=https://file.52funny.top/blogpic/4956a82b7f4ea92da698cc553e1e032c.png alt=KINGOSOFT教务系统登陆></p><h3 id=获取-cookie>获取 Cookie</h3><p>首先我们可以访问教务系统的网址,然后获取 Cookie 的<code>JSESSIONID</code>值将其进行保存.</p><p><img src=https://file.52funny.top/blogpic/e1c82844acf7b88561f00dec8480daa0.jpg alt=Cookie></p><h3 id=加密账号密码信息>加密账号密码信息</h3><p>这时我们来分析一下网页 HTML 文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>td</span> <span style=color:#a6e22e>colspan</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2&#34;</span> <span style=color:#a6e22e>height</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;26px&#34;</span> <span style=color:#a6e22e>align</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span> <span style=color:#a6e22e>valign</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;top&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;button&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;login&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;login&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;login&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;doLogon();&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hidden&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;reset&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;reset&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;reset&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;doReset();&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;javascript:void(0);&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MobileReset();&#34;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;padding-left: 10px;&#34;</span>&gt;忘记密码&lt;/<span style=color:#f92672>a</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>td</span>&gt;
</span></span></code></pre></div><p>我们可以看见当按了登陆按钮时,这是我们执行的是一个<code>doLogin</code>的 JavaScript 的代码</p><p>我们继续找到这个 <code>doLogin</code> 的函数,发现他在这个 JavaScript 文件里</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/suzxyjw/frame/Login.js?version=20181119&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>继续找到这个文件里的<code>doLogin</code> 函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>doLogon</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 输入信息验证
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>validate</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 验证码正确性验证
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#yhmc&#39;</span>).<span style=color:#a6e22e>val</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#yhmm&#39;</span>).<span style=color:#a6e22e>val</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>randnumber</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#randnumber&#39;</span>).<span style=color:#a6e22e>val</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>passwordPolicy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>kutil</span>.<span style=color:#a6e22e>isPasswordPolicy</span>(<span style=color:#a6e22e>username</span>, <span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_webRootPath</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;cas/logon.action&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>txt_mm_expression</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_expression&#39;</span>).<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>txt_mm_length</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_length&#39;</span>).<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>txt_mm_userzh</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_userzh&#39;</span>).<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>password</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>randnumber</span>.<span style=color:#a6e22e>toLowerCase</span>()))
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	var params = {
</span></span></span><span style=display:flex><span><span style=color:#75715e>					&#34;yhmc&#34; : username,
</span></span></span><span style=display:flex><span><span style=color:#75715e>					&#34;yhmm&#34; : password,
</span></span></span><span style=display:flex><span><span style=color:#75715e>					&#34;randnumber&#34;: randnumber,
</span></span></span><span style=display:flex><span><span style=color:#75715e>					&#34;isPasswordPolicy&#34; : passwordPolicy
</span></span></span><span style=display:flex><span><span style=color:#75715e>				};
</span></span></span><span style=display:flex><span><span style=color:#75715e>	*/</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p_username</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;_u&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>randnumber</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p_password</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;_p&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>randnumber</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64encode</span>(<span style=color:#a6e22e>username</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;;;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>_sessionid</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>p_username</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>username</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&amp;&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>p_password</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>password</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&amp;randnumber=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>randnumber</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&amp;isPasswordPolicy=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>passwordPolicy</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&amp;txt_mm_expression=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>txt_mm_expression</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&amp;txt_mm_length=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>txt_mm_length</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&amp;txt_mm_userzh=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>txt_mm_userzh</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//alert(&#34;params=&#34;+params);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getEncParams</span>(<span style=color:#a6e22e>params</span>)
</span></span><span style=display:flex><span>  <span style=color:#75715e>//alert(&#34;encparams=&#34;+params);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>doPreLogon</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kutil</span>.<span style=color:#a6e22e>doAjax</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>params</span>, <span style=color:#a6e22e>doPostLogon</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>doPreLogon</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#msg&#39;</span>).<span style=color:#a6e22e>html</span>(<span style=color:#e6db74>&#39;正在登录......&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#login&#39;</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;disabled&#39;</span>, <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#reset&#39;</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;disabled&#39;</span>, <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>doPostLogon</span>(<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>response</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>message</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#39;200&#39;</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>status</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>      window.document.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>reloadScript</span>(<span style=color:#e6db74>&#39;kingo_encypt&#39;</span>, <span style=color:#a6e22e>_webRootPath</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;custom/js/SetKingoEncypt.jsp&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#39;407&#39;</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>status</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>message</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>showMessage</span>(<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>showMessage</span>(<span style=color:#a6e22e>message</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#login&#39;</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;disabled&#39;</span>, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#reset&#39;</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;disabled&#39;</span>, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>refreshImg</span>()
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#39;401&#39;</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>status</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#randnumber&#39;</span>).<span style=color:#a6e22e>val</span>(<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#randnumber&#39;</span>).<span style=color:#a6e22e>focus</span>()
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#yhmc&#39;</span>).<span style=color:#a6e22e>val</span>(<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#yhmm&#39;</span>).<span style=color:#a6e22e>val</span>(<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#randnumber&#39;</span>).<span style=color:#a6e22e>val</span>(<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j$</span>(<span style=color:#e6db74>&#39;#yhmc&#39;</span>).<span style=color:#a6e22e>focus</span>()
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>我们继续来分析</p><p>首先<code>username, password, randnumber</code> 就是你的账号密码和验证码</p><p>其次<code>passwordPolicy</code> 是一个函数的返回值我没有找到这个函数但是我用了一种方法就是在控制台来输出函数的返回值.</p><p>我随便试了一个账户和密码</p><p><img src=https://file.52funny.top/blogpic/39ab12c545d398e499796a420461b9c3.jpg alt=Xnip2020-04-13_19-20-29></p><p>然后他的返回值是<code>0</code></p><p>然后输入了正确的账号密码</p><p><img src=https://file.52funny.top/blogpic/a2fb5404dd1a9f67ba21a6cc3dbcae52.jpg alt=Xnip2020-04-13_19-25-18></p><p>然后他的返回值是<code>1</code></p><p>所以我们只需要知道<code>passwordPolicy</code>的值是<code>1</code></p><p>接着分析 <code>txt_mm_expression</code> <code>txt_mm_length</code> <code>txt_mm_userzh</code> 这三个变量是通过获取元素的值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>txt_mm_expression</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_expression&#39;</span>).<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>txt_mm_length</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_length&#39;</span>).<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>txt_mm_userzh</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_userzh&#39;</span>).<span style=color:#a6e22e>value</span>
</span></span></code></pre></div><p>然后我就在之前的 HTML 文件中找到声明这三个变量的 JavaScrpt 代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>checkpwd</span>(<span style=color:#a6e22e>oInput</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pwd</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>oInput</span>.<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>len</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pwd</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>len</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>|=</span> <span style=color:#a6e22e>charType</span>(<span style=color:#a6e22e>pwd</span>.<span style=color:#a6e22e>charCodeAt</span>(<span style=color:#a6e22e>i</span>))
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_expression&#39;</span>).<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span> <span style=color:#75715e>//密码规则
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_length&#39;</span>).<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pwd</span>.<span style=color:#a6e22e>length</span> <span style=color:#75715e>//密码长度
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>userzh</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;yhmc&#39;</span>).<span style=color:#a6e22e>value</span> <span style=color:#75715e>//取账号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>inuserzh</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;0&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pwd</span>.<span style=color:#a6e22e>toLowerCase</span>().<span style=color:#a6e22e>trim</span>().<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>userzh</span>.<span style=color:#a6e22e>toLowerCase</span>().<span style=color:#a6e22e>trim</span>()) <span style=color:#f92672>&gt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inuserzh</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;txt_mm_userzh&#39;</span>).<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>inuserzh</span> <span style=color:#75715e>//判断密码是否包含账号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>charType</span>(<span style=color:#a6e22e>num</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>num</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>48</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>num</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>57</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>num</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>97</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>num</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>122</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>num</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>65</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>num</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>90</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>通过代码分析可知<code>txt_mm_expression</code> 是一个密码的复杂度遵从以下规则</p><table><thead><tr><th style=text-align:center>数字</th><th style=text-align:center>大写字母</th><th style=text-align:center>小写字母</th><th style=text-align:center>其他符号</th></tr></thead><tbody><tr><td style=text-align:center>8</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>1</td></tr></tbody></table><p>比如我的密码是以下几种情况的话, 返回值分别如下</p><pre tabindex=0><code>123 -&gt; 8
123A -&gt; 10
123Aa -&gt; 14
123Aa# -&gt; 15
</code></pre><p><code>txt_mm_length</code>就很简单了, 他就是密码的长度.</p><p><code>txt_mm_userzh</code> 从他的注释来看就是判断密码是否包含账号.</p><p>接着我们来分析<code>doLogin</code>函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>password</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>randnumber</span>.<span style=color:#a6e22e>toLowerCase</span>()))
</span></span></code></pre></div><p><code>hex_md5</code> 函数就是把字符串变成 md5 值</p><p>然后他将这些变量进行<code>base64encode</code> 最后得到一个<code>params</code> 变量</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p_username</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;_u&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>randnumber</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p_password</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;_p&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>randnumber</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64encode</span>(<span style=color:#a6e22e>username</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;;;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>_sessionid</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p_username</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>username</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;&amp;&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p_password</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>password</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;&amp;randnumber=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randnumber</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;&amp;isPasswordPolicy=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>passwordPolicy</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;&amp;txt_mm_expression=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>txt_mm_expression</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;&amp;txt_mm_length=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>txt_mm_length</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;&amp;txt_mm_userzh=&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>txt_mm_userzh</span>
</span></span></code></pre></div><p>然后将<code>params</code> 用<code>getEncParams</code> 函数加密</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getEncParams</span>(<span style=color:#a6e22e>params</span>)
</span></span></code></pre></div><p>然后发现他在另一个 JavaScript 文件里</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/suzxyjw/custom/js/SetKingoEncypt.jsp?t=4901586828474712746&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;kingo_encypt&#34;</span>
</span></span><span style=display:flex><span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>但是这个 JavaScript 文件后面的链接 t 后面的参数是 刷新一次网页就会变的,所以我们要用正则表达式进行提取 <code>/suzxyjw/custom/js/SetKingoEncypt.jsp\?t=[0-9]+</code></p><p>然后打开这个 JavaScript 脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_deskey</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;6061586830242491265&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_nowtime</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2020-04-14 10:10:42&#39;</span>
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>write</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;&lt;script type=&#39;text/javascript&#39; src=&#39;http://211.86.128.194:80/suzxyjw/custom/js/base64.js&#39;&gt;&lt;/script&gt;&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>write</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;&lt;script type=&#39;text/javascript&#39; src=&#39;http://211.86.128.194:80/suzxyjw/custom/js/md5.js&#39;&gt;&lt;/script&gt;&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>write</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;&lt;script type=&#39;text/javascript&#39; src=&#39;http://211.86.128.194:80/suzxyjw/custom/js/jkingo.des.js&#39;&gt;&lt;/script&gt;&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>b64_encode</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>base64encode</span>(<span style=color:#a6e22e>utf16to8</span>(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>b64_decode</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>utf8to16</span>(<span style=color:#a6e22e>base64decode</span>(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>des_encode</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>strEnc</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>_deskey</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>des_decode</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>strDec</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>_deskey</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getEncParams</span>(<span style=color:#a6e22e>params</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>timestamp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_nowtime</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>params</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>timestamp</span>))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_params</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>b64_encode</span>(<span style=color:#a6e22e>des_encode</span>(<span style=color:#a6e22e>params</span>))
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_params</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;params=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>_params</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;&amp;token=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;&amp;timestamp=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>timestamp</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>_params</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>reloadScript00</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>jsfile</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>jsfile</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jsfile</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;?random=&#39;</span> <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>random</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;kingo_encypt&#39;</span>) document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;kingo_encypt&#39;</span>).<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jsfile</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>reloadScript</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>jsfile</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>oldS</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>oldS</span>) <span style=color:#a6e22e>oldS</span>.<span style=color:#a6e22e>parentNode</span>.<span style=color:#a6e22e>removeChild</span>(<span style=color:#a6e22e>oldS</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>t</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;script&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>new</span> String(<span style=color:#a6e22e>jsfile</span>).<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#39;?&#39;</span>) <span style=color:#f92672>&gt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jsfile</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jsfile</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;&amp;random=&#39;</span> <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>random</span>()
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jsfile</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jsfile</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;?random=&#39;</span> <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>random</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jsfile</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;text/javascript&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>getElementsByTagName</span>(<span style=color:#e6db74>&#39;head&#39;</span>)[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>G_LOGIN_ID</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;kingo.guest&#39;</span>
</span></span></code></pre></div><p>发现<code>getEncParams</code> 这个函数里面有一个函数<code>des_encode</code></p><p>这个<code>des_encode</code> 里面有一个函数 <code>strEnc(data, _deskey, null, null)</code></p><p><code>strEnc</code> 接受四个参数 <code>data</code>, <code>firstKey</code>, <code>secondKey</code>, <code>thirdKey</code>.</p><blockquote><p>jkingo.des.js 链接我将放置文章末尾</p></blockquote><p>这里有个坑就是我们访问这个<code>SetKingoEncypt.jsp</code> 链接是 我们必须要携带 Cookie 访问, 而且每次访问出来的<code>_deskey</code>, <code>_nowtime</code> 都是不一样的, 这里我们还是要进行字符串的提取可以用正则也可以用其他的.</p><h3 id=提交登陆信息>提交登陆信息</h3><p>最后通过 Post 请求发送数据表单</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#e6db74>&#39;params=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>_params</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;&amp;token=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;&amp;timestamp=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>timestamp</span>
</span></span></code></pre></div><p>表单总共有三个数据 <code>params</code>, <code>token</code>, <code>timestamp</code></p><p>最后发送 POST 请求后可以得到如下的 JSON 数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;操作成功!&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;result&#34;</span>: <span style=color:#e6db74>&#34;/suzxyjw/MainFrm.html?random=0.14040851742858051&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#e6db74>&#34;200&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>最后就可以用 CookIe 进行其他的操作了.</p><blockquote><p><a href=http://211.86.128.194:80/suzxyjw/custom/js/jkingo.des.js target=_blank rel="noopener noreferrer">jkingo.des.js</a></p><p><a href=https://github.com/52funny/KINGOSOFT-LOGIN target=_blank rel="noopener noreferrer">演示代码(仅供参考)</a></p></blockquote></article><section class="article labels"><a class=tag href=/tags/go/>Go</a></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/014/><span class="iconfont icon-article"></span>API接口</a></p><p><a class=link href=/posts/012/><span class="iconfont icon-article"></span>超星学习通签到</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>52funny Blog</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank rel="noopener noreferrer">Notepadium</a></p></div></section><script defer type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity=sha384-e/4/LvThKH1gwzXhdbY2AsjR3rm7LHWyhIG5C0jiRfn8AN2eTN5ILeztWw0H9jmN crossorigin=anonymous></script>
<script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><script src=/js/hljs.min.6f979583f61e4ec5f0b94f94eab2e130ee628032474d374414dba4e33cc12097a0d01fe65b33378b23f6d3b053b95445.js integrity=sha384-b5eVg/YeTsXwuU+U6rLhMO5igDJHTTdEFNuk4zzBIJeg0B/mWzM3iyP207BTuVRF></script><script>hljs.initHighlightingOnLoad()</script></body></html>